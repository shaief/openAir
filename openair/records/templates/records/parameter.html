{% extends "base.html" %}
{% load static %}

{% block title %}
openAir - Parameter: {{ parameter.abbr }}
{% endblock %}

{% block content %}
<h1>Parameter: {{ parameter.abbr }}</h1>

<div style="color: red">
Debugging:<br >
low standard level {{ parameter.low_level }}<br >
high standard level {{ parameter.high_level }}<br >
</div>

<table class="table">
	<thead><tr>
	<th>Zone</th>
	<th>Station</th>
	<th>Value</th>
	<th width="200px"></th>
	</tr></thead>
	<tbody id="records"></tbody>
</table>

<div class='d3'></div>

<script type="text/javascript">

	var table = d3.select("#records");

	var w = 180
	var h = 20
	var pad = 10

	x = d3.scale.linear()

	d3.json("{% url 'parameter_json' parameter.abbr %}", function(data) {

		var records = table.selectAll("tr")
						   .data(data)
						   .enter()
						   .append("tr");

		var zones = records.append("td")
						   .text(function(d) {
						   		return d["zone"];
						   });

		var names = records.append("td")
						   .text(function(d) {
						   		return d["name"]; 
						   });

		var values = records.append("td")
							.text(function(d) {
								return d["value"]
							})

		x.domain([d3.min(data, function(d) { return d['value']; }),
				 d3.max(data, function(d) { return d['value']; })]);

		x.rangeRound([pad, w - pad]);

		var graph = records.append("td")
				           .append("svg")
				           .attr({
				           		class: 'graph',
				           		w: w,
				           		h: h,
				           });

		var marker = graph.append("circle")
				          .attr({
				        	   	cx: function(d) { return x(d['value']); },
				        	   	cy: h / 2,
				        	   	r: 3,
				          });

		{% if parameter.low_level %}
		var low = graph.append("line")
					   .attr({
					   		x1: x({{ parameter.low_level }}),
					   		y1: 0,
					   		x2: x({{ parameter.low_level }}),
					   		y2: h,
			        	   	stroke: "red"
					   });
		{% endif %}

		{% if parameter.high_level %}
		var low = graph.append("line")
					   .attr({
					   		x1: x({{ parameter.high_level }}),
					   		y1: 0,
					   		x2: x({{ parameter.high_level }}),
					   		y2: h,
			        	   	stroke: "red"
					   });
		{% endif %}
	});

</script>
{% endblock %}
